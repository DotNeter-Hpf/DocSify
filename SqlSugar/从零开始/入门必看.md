## 1.ä¸Šä¸‹æ–‡æ¦‚å¿µ

* åŒæ­¥æƒ…å†µï¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹æ˜¯åŒä¸€ä¸ªä¸Šä¸‹æ–‡
* å¼‚æ­¥æƒ…å†µï¼šåœ¨åŒä¸€ä¸²awaitä¸­æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡(awaitä¼šæ”¹å˜çº¿ç¨‹ï¼Œå’ŒåŒæ­¥æ˜¯ä¸ä¸€æ ·çš„)

## 2.åˆ›å»ºå¯¹è±¡

SqlSugarClientÂ  å’Œ SqlSugarScope

### 2.1 SqlSugarClientÂ 
**`ä¼˜ç‚¹ï¼š`**
* æ€§èƒ½æ¯”SqlSugarScopeæœ‰5%çš„æå‡

**`ç¼ºç‚¹ï¼š`**
* ä¸èƒ½ä½¿ç”¨å•ä¾‹
* dbä¸èƒ½è·¨ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼Œæ¯æ¬¡éœ€è¦newä¸€ä¸ªæ–°å¯¹è±¡
* å¶å‘é”™è¯¯éš¾æ’æŸ¥ï¼Œé€‚åˆæœ‰ç»éªŒçš„ç”¨æˆ·

#### 2.1.1 é™æ€æ–¹æ³•æ¡ˆä¾‹
`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
public class Sugar
    {
        public static SqlSugarClient GetInstance()
        {
            SqlSugarClient db = new SqlSugarClient(new ConnectionConfig()
            {
                DbType = SqlSugar.DbType.MySql,
                ConnectionString = "server = 127.0.0.1; Database = sugarlearn; Uid = root; Pwd = root; AllowLoadLocalInfile = true;",
                InitKeyType = InitKeyType.Attribute,
                IsAutoCloseConnection = true,
                LanguageType= LanguageType.Default
            });

            //æ¯æ¬¡Sqlæ‰§è¡Œå‰äº‹ä»¶
            db.Aop.OnLogExecuting = (sql, pars) =>
            {
                var queryString = new KeyValuePair<string, SugarParameter[]>(sql, pars);
                //ToSqlExplain åœ¨æ ‡é¢˜6ä¸­æœ‰å®Œæ•´ä»£ç 
                Console.WriteLine(ToSqlExplain.GetSql(queryString));//è¾“å‡ºsql
            };

            //SQLæ‰§è¡Œå®Œ
            db.Aop.OnLogExecuted = (sql, pars) =>
            {
                //æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’
                if (db.Ado.SqlExecutionTime.TotalSeconds > 1)
                {
                    //ä»£ç CSæ–‡ä»¶å
                    var fileName = db.Ado.SqlStackTrace.FirstFileName;
                    //ä»£ç è¡Œæ•°
                    var fileLine = db.Ado.SqlStackTrace.FirstLine;
                    //æ–¹æ³•å
                    var FirstMethodName = db.Ado.SqlStackTrace.FirstMethodName;
                    //sql
                    var exesql = sql;
                    //å‚æ•°
                    var sqlpars = pars;
                    //db.Ado.SqlStackTrace.MyStackTraceList[1].xxx è·å–ä¸Šå±‚æ–¹æ³•çš„ä¿¡æ¯
                }
            };

            //SQLæŠ¥é”™
            db.Aop.OnError = (exp) =>
            {
                Console.WriteLine(exp.Sql);
                //exp.sql è¿™æ ·å¯ä»¥æ‹¿åˆ°é”™è¯¯SQL            
            };
            return db;
        }
    }
```

`è°ƒç”¨å¯¹è±¡ï¼š`
```csharp
static void Main(string[] args)
{
    var db = Sugar.GetInstance();
    bool connect = db.Ado.IsValidConnection(); //éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ
    List<Student> list = db.Queryable<Student>().ToList(); //æŸ¥è¯¢Studentè¡¨ä¸­æ‰€æœ‰æ•°æ®
    Console.ReadLine();
}
```

#### 2.1.2 SqlSugar.IOCæ³¨å…¥æ¡ˆä¾‹
`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
//Program.csä¸­æ·»åŠ å¦‚ä¸‹ä»£ç 

SugarIocServices.AddSqlSugar(new IocConfig()
{
    //ConfigId="db01"  å¤šç§Ÿæˆ·ç”¨åˆ°
    ConnectionString = "server=127.0.0.1;Database=ToDoDB;Uid=root;Pwd=root; AllowLoadLocalInfile=true;",
    DbType = IocDbType.MySql,
    IsAutoCloseConnection = true//è‡ªåŠ¨é‡Šæ”¾
}); //å¤šä¸ªåº“å°±ä¼ List<IocConfig>

//é…ç½®å‚æ•°
SugarIocServices.ConfigurationSugar(db =>
{
    db.Aop.OnLogExecuting = (sql, p) =>
    {
        Console.WriteLine(sql);
    };
    //è®¾ç½®æ›´å¤šè¿æ¥å‚æ•°
    //db.CurrentConnectionConfig.XXXX=XXXX
    //db.CurrentConnectionConfig.MoreSettings=new ConnMoreSettings(){}
    //äºŒçº§ç¼“å­˜è®¾ç½®
    //db.CurrentConnectionConfig.ConfigureExternalServices = new ConfigureExternalServices()
    //{
    // DataInfoCacheService = myCache //é…ç½®æˆ‘ä»¬åˆ›å»ºçš„ç¼“å­˜ç±»
    //}
    //è¯»å†™åˆ†ç¦»è®¾ç½®
    //laveConnectionConfigs = new List<SlaveConnectionConfig>(){...}

    /*å¤šç§Ÿæˆ·æ³¨æ„*/
    //å•åº“æ˜¯db.CurrentConnectionConfig 
    //å¤šç§Ÿæˆ·éœ€è¦db.GetConnection(configId).CurrentConnectionConfig 
});
```


`è°ƒç”¨å¯¹è±¡ï¼š`

```csharp
public class TestController : ControllerBase
{
    private static readonly SqlSugarClient db = DbScoped.Sugar;
    
    public TestController()
    {
Â Â Â  }
    
    public JsonResult Test()
    {
        var cs = db.Queryable<Student>().ToList();
        return new JsonResult(cs);
    }
}
```


#### 2.1.3 .NET IOCæ³¨å…¥æ¡ˆä¾‹
`æ³¨æ„ï¼šSqlSugarClientç”¨ AddScoped  æ¯æ¬¡è¯·æ±‚ä¸€ä¸ªå®ä¾‹`

`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
public static class SqlsugarSetup
    {
        public static void AddSqlsugarSetup(this IServiceCollection services)
        {
            SqlSugarClient db = new SqlSugarClient(new ConnectionConfig()
            {
                ConnectionString = "server=127.0.0.1;Database=ToDoDB;Uid=root;Pwd=root; AllowLoadLocalInfile=true;",
                DbType = DbType.MySql,
                IsAutoCloseConnection = true,
            });

            //æ¯æ¬¡Sqlæ‰§è¡Œå‰äº‹ä»¶
            db.Aop.OnLogExecuting = (sql, pars) =>
            {
                var queryString = new KeyValuePair<string, SugarParameter[]>(sql, pars);
                //ToSqlExplain åœ¨æ ‡é¢˜6ä¸­æœ‰å®Œæ•´ä»£ç 
                Console.WriteLine(ToSqlExplain.GetSql(queryString));//è¾“å‡ºsql
            };

            //æ¯æ¬¡Sqlæ‰§è¡Œåäº‹ä»¶
            db.Aop.OnLogExecuted = (sql, pars) =>
            {
                //æ‰§è¡Œæ—¶é—´è¶…è¿‡10ç§’
                if (db.Ado.SqlExecutionTime.TotalSeconds > 10)
                {
                    Console.WriteLine(sql);
                }
            };

            //SQLæŠ¥é”™
            db.Aop.OnError = (exp) =>
            {
                Console.WriteLine(exp.Sql);
                //exp.sql è¿™æ ·å¯ä»¥æ‹¿åˆ°é”™è¯¯SQL            
            };

            services.AddScoped<ISqlSugarClient>(it => { return db; });
        }
    }
```

`Program.cs ä¾èµ–æ³¨å…¥ï¼š`
```csharp
builder.Services.AddSqlsugarSetup();
```

`è°ƒç”¨å¯¹è±¡ï¼š`
```csharp
private readonly ISqlSugarClient db;
public ToDoService(ISqlSugarClient _sqlSugarClient)
{
    db = _sqlSugarClient;
}

public void Test()
{
    var list = db.Queryable<Student>();
}
```

### 2.2 SqlSugarScope
**`ä¼˜ç‚¹ï¼š`**
* å¿…é¡»ä½¿ç”¨å•ä¾‹æ¨¡å¼
* æ¨èæ²¡æœ‰.NETå¼€å‘ç»éªŒçš„æ–°æ‰‹ä½¿ç”¨
* ä¸ç”¨è€ƒè™‘ä»»ä½•çº¿ç¨‹é—®é¢˜ï¼Œæ— è„‘ä½¿ç”¨ï¼Œç®€å•çœäº‹ï¼Œè¾ƒå¼ºæ€§èƒ½
æ”¯æŒåŒä¸€ä¸ªä¸Šä¸‹æ–‡å…±äº«äº‹åŠ¡

**`ç¼ºç‚¹ï¼š`**
* ä¸ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼ŒSqlSugarScope ä¸€ç›´ new ä¼šå­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜


#### 2.2.1 é™æ€å­—æ®µæ¡ˆä¾‹
`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
public class Sugar
    {
        public static SqlSugarScope db = new SqlSugarScope(new ConnectionConfig()
        {
            ConnectionString = "server = 127.0.0.1; Database = sugarlearn; Uid = root; Pwd = root; AllowLoadLocalInfile = true;",//è¿æ¥ç¬¦å­—ä¸²
            DbType = DbType.MySql,//æ•°æ®åº“ç±»å‹
            IsAutoCloseConnection = true //ä¸è®¾æˆtrueè¦æ‰‹åŠ¨close
        },
            db =>
            {
                //è°ƒè¯•SQLäº‹ä»¶
                db.Aop.OnLogExecuting = (sql, pars) =>
                 {
                     var queryString = new KeyValuePair<string, SugarParameter[]>(sql, pars);
                     //ToSqlExplain åœ¨æ ‡é¢˜6ä¸­æœ‰å®Œæ•´ä»£ç 
                     Console.WriteLine(ToSqlExplain.GetSql(queryString));//è¾“å‡ºsql
                 };
                db.Aop.OnLogExecuted = (sql, pars) =>
                {
                    //æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’
                    if (db.Ado.SqlExecutionTime.TotalSeconds > 1)
                    {
                        //ä»£ç CSæ–‡ä»¶å
                        var fileName = db.Ado.SqlStackTrace.FirstFileName;
                        //ä»£ç è¡Œæ•°
                        var fileLine = db.Ado.SqlStackTrace.FirstLine;
                        //æ–¹æ³•å
                        var FirstMethodName = db.Ado.SqlStackTrace.FirstMethodName;
                        //sql
                        var exesql = sql;
                        //å‚æ•°
                        var sqlpars = pars;
                        //db.Ado.SqlStackTrace.MyStackTraceList[1].xxx è·å–ä¸Šå±‚æ–¹æ³•çš„ä¿¡æ¯
                    }
                };
            });
    }
```


`è°ƒç”¨æ–¹æ³•ä¸€(ç±»è°ƒç”¨)ï¼š`
```csharp
class Program
    {
        static void Main(string[] args)
        {
            bool connect = Sugar.db.Ado.IsValidConnection(); //éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ
            List<Student> list = Sugar.db.Queryable<Student>().ToList(); //æŸ¥è¯¢Studentè¡¨ä¸­æ‰€æœ‰æ•°æ®
            Console.ReadLine();
        }
    }
```

`è°ƒç”¨æ–¹æ³•äºŒ(ç»§æ‰¿æ–¹å¼å•ä¾‹)ï¼š`
```csharp
class Program : Sugar
    {
        static void Main(string[] args)
        {
            bool connect = db.Ado.IsValidConnection(); //éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ
            List<Student> list = db.Queryable<Student>().ToList(); //æŸ¥è¯¢Studentè¡¨ä¸­æ‰€æœ‰æ•°æ®
            Console.ReadLine();
        }
    }
```

#### 2.2.2 SqlSugar.IOCæ³¨å…¥æ¡ˆä¾‹

`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
//Program.csä¸­æ·»åŠ å¦‚ä¸‹ä»£ç 

SugarIocServices.AddSqlSugar(new IocConfig()
{
    //ConfigId="db01"  å¤šç§Ÿæˆ·ç”¨åˆ°
    ConnectionString = "server=127.0.0.1;Database=ToDoDB;Uid=root;Pwd=root; AllowLoadLocalInfile=true;",
    DbType = IocDbType.MySql,
    IsAutoCloseConnection = true//è‡ªåŠ¨é‡Šæ”¾
}); //å¤šä¸ªåº“å°±ä¼ List<IocConfig>

//é…ç½®å‚æ•°
SugarIocServices.ConfigurationSugar(db =>
{
    db.Aop.OnLogExecuting = (sql, p) =>
    {
        Console.WriteLine(sql);
    };
    //è®¾ç½®æ›´å¤šè¿æ¥å‚æ•°
    //db.CurrentConnectionConfig.XXXX=XXXX
    //db.CurrentConnectionConfig.MoreSettings=new ConnMoreSettings(){}
    //äºŒçº§ç¼“å­˜è®¾ç½®
    //db.CurrentConnectionConfig.ConfigureExternalServices = new ConfigureExternalServices()
    //{
    // DataInfoCacheService = myCache //é…ç½®æˆ‘ä»¬åˆ›å»ºçš„ç¼“å­˜ç±»
    //}
    //è¯»å†™åˆ†ç¦»è®¾ç½®
    //laveConnectionConfigs = new List<SlaveConnectionConfig>(){...}

    /*å¤šç§Ÿæˆ·æ³¨æ„*/
    //å•åº“æ˜¯db.CurrentConnectionConfig 
    //å¤šç§Ÿæˆ·éœ€è¦db.GetConnection(configId).CurrentConnectionConfig 
});
```


`è°ƒç”¨å¯¹è±¡ï¼š`

```csharp
public class TestController : ControllerBase
{
    private static readonly SqlSugarScope db = DbScoped.SugarScope;
    
    public TestController()
    {
Â Â Â  }
    
    public JsonResult Test()
    {
        var cs = db.Queryable<Student>().ToList();
        return new JsonResult(cs);
    }
}
```

#### 2.2.3 .NET IOCæ³¨å…¥æ¡ˆä¾‹
`æ³¨æ„ï¼šSqlSugarScopeç”¨å•ä¾‹AddSingleton  å•ä¾‹`

`åˆ›å»ºå¯¹è±¡ï¼š`
```csharp
public static class SqlsugarSetup
    {
        public static void AddSqlsugarSetup(this IServiceCollection services)
        {
            SqlSugarScope sqlSugar = new SqlSugarScope(new ConnectionConfig()
            {
                DbType = SqlSugar.DbType.MySql,
                ConnectionString = "server = 127.0.0.1; Database = ToDoDB; Uid = root; Pwd = root; AllowLoadLocalInfile = true;",
                IsAutoCloseConnection = true,
            },
                db =>
                {
                    //å•ä¾‹å‚æ•°é…ç½®ï¼Œæ‰€æœ‰ä¸Šä¸‹æ–‡ç”Ÿæ•ˆ
                    db.Aop.OnLogExecuting = (sql, pars) =>
                        {
                        //Console.WriteLine(sql);//è¾“å‡ºsql
                    };
                    //æ¯æ¬¡Sqlæ‰§è¡Œå‰äº‹ä»¶
                    db.Aop.OnLogExecuting = (sql, pars) =>
                    {
                        var queryString = new KeyValuePair<string, SugarParameter[]>(sql, pars);
                        //ToSqlExplain åœ¨æ ‡é¢˜6ä¸­æœ‰å®Œæ•´ä»£ç 
                        Console.WriteLine(ToSqlExplain.GetSql(queryString));//è¾“å‡ºsql
                    };

                    //SQLæ‰§è¡Œå®Œ
                    db.Aop.OnLogExecuted = (sql, pars) =>
                    {
                        //æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’
                        if (db.Ado.SqlExecutionTime.TotalSeconds > 1)
                        {
                            //ä»£ç CSæ–‡ä»¶å
                            var fileName = db.Ado.SqlStackTrace.FirstFileName;
                            //ä»£ç è¡Œæ•°
                            var fileLine = db.Ado.SqlStackTrace.FirstLine;
                            //æ–¹æ³•å
                            var FirstMethodName = db.Ado.SqlStackTrace.FirstMethodName;
                            //sql
                            var exesql = sql;
                            //å‚æ•°
                            var sqlpars = pars;
                            //db.Ado.SqlStackTrace.MyStackTraceList[1].xxx è·å–ä¸Šå±‚æ–¹æ³•çš„ä¿¡æ¯
                        }
                    };

                    //SQLæŠ¥é”™
                    db.Aop.OnError = (exp) =>
                    {
                        Console.WriteLine(exp.Sql);
                        //exp.sql è¿™æ ·å¯ä»¥æ‹¿åˆ°é”™è¯¯SQL            
                    };
                });
            services.AddSingleton<ISqlSugarClient>(sqlSugar);//è¿™è¾¹æ˜¯SqlSugarScopeç”¨AddSingleton
        }
    }
```


`Program.cs ä¾èµ–æ³¨å…¥ï¼š`
```csharp
builder.Services.AddSqlsugarSetup();
```

`è°ƒç”¨å¯¹è±¡ï¼š`
```csharp
private readonly ISqlSugarClient db;
public ToDoService(ISqlSugarClient _sqlSugarClient)
{
    db = _sqlSugarClient;
}

public void Test()
{
    var list = db.Queryable<Student>();
}
```

## 3.è¿æ¥å‚æ•°

| åç§° | æè¿° | å¿…å¡« |
| --- | --- | --- | 
DbType  | æ•°æ®åº“ç±»å‹ | æ˜¯ | 
ConnectionString | è¿æ¥å­—ç¬¦ä¸² | æ˜¯ | 
IsAutoCloseConnection | æ‰‹åŠ¨é‡Šæ”¾(é•¿è¿æ¥)ï¼Œè‡ªåŠ¨é‡Šæ”¾(çŸ­è¿æ¥) | æ¨èè‡ªåŠ¨é‡Šæ”¾ true | 
ConfigureExternalServices  | ä¸€äº›æ‰©å±•å±‚åŠ¡çš„é›†æˆ |  | 
MoreSettings  | æ›´å¤šè®¾ç½® | æ¯”å¦‚ï¼šé…ç½®æœ€å°æ—¶é—´ | 
SlaveConnectionConfigs  | ä¸»ä»è®¾ç½® |  | 
LanguageType  | é”™è¯¯æç¤ºè®¾ç½®è¯­è¨€ | ä¸­æ–‡ã€è‹±æ–‡ã€ä¸­è‹±æ–‡æ··åˆ | 

## 4.è®¾ç½®è¶…æ—¶æ—¶é—´
`é»˜è®¤æ˜¯30ç§’`

* æ–¹æ³•ä¸€ï¼šåœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­æ·»åŠ  Connect Timeout=30ï¼›
* æ–¹æ³•äºŒï¼šåˆ›å»ºå¯¹è±¡ä¸­æ·»åŠ ä»£ç 
```csharp
db.Ado.CommandTimeOutÂ =Â 30;//å•ä½ç§’
```

## 5.éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ
```csharp
//trueï¼šä»£è¡¨è¿æ¥æˆåŠŸ
bool connect = db.Ado.IsValidConnection(); 
```


## 6.æ‰“å°Sql

`Sqlæ‰§è¡Œå‰çš„äº‹ä»¶`
`åœ¨ db.Aop.OnLogExecuting ä¸­æ‹¼æ¥å‡ºå®Œæ•´Sql`
```csharp
 //æ¯æ¬¡Sqlæ‰§è¡Œå‰äº‹ä»¶
db.Aop.OnLogExecuting = (sql, pars) =>
{
    var queryString = new KeyValuePair<string, SugarParameter[]>(sql, pars);
    Console.WriteLine(ToSqlExplain.GetSql(queryString));//è¾“å‡ºsql
};
```


`ToSqlExplain.GetSqlç±»ä¸­çš„æ–¹æ³•(æ‹¼æ¥å‡ºå®Œæ•´çš„Sqlï¼Œæ–¹ä¾¿æŸ¥çœ‹)`
```csharp
public class ToSqlExplain
    {
        public static string GetSql(KeyValuePair<string, SugarParameter[]> queryString)
        {
            var sql = queryString.Key;//sqlè¯­å¥
            var par = queryString.Value;//å‚æ•°

            //å­—ç¬¦ä¸²æ›¿æ¢MethodConst1xä¼šæ›¿æ¢æ‰MethodConst1æ‰€æœ‰è¦ä»åå¾€å‰æ›¿æ¢,ä¸èƒ½ç”¨foreach,åç»­å¯ä»¥ä¼˜åŒ–
            for (int i = par.Length - 1; i >= 0; i--)
            {
                if (par[i].ParameterName.StartsWith("@") && par[i].ParameterName.Contains("UnionAll"))
                {
                    sql = sql.Replace(par[i].ParameterName, par[i].Value.ToString());
                }
            }

            for (int i = par.Length - 1; i >= 0; i--)
            {
                if (par[i].ParameterName.StartsWith("@Method"))
                {
                    sql = sql.Replace(par[i].ParameterName, "'" + par[i].Value.ToString() + "'");
                }
            }
            for (int i = par.Length - 1; i >= 0; i--)
            {
                if (par[i].ParameterName.StartsWith("@Const"))
                {
                    sql = sql.Replace(par[i].ParameterName, par[i].Value.ToString());
                }
            }
            for (int i = par.Length - 1; i >= 0; i--)
            {
                if (par[i].ParameterName.StartsWith("@"))
                {
                    //å€¼æ‹¼æ¥å•å¼•å· æ‹¿å‡ºæ¥çš„sqlä¸ä¼šæŠ¥é”™
                    sql = sql.Replace(par[i].ParameterName, "'" + Convert.ToString(par[i].Value) + "'");
                }
            }
            return sql;
        }
    }
```

## 7.å›½é™…åŒ–
`åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æŒ‡å®šè¯­è¨€`

* æšä¸¾è¯´æ˜
```csharp
publicÂ enumÂ LanguageType
Â Â Â Â {
Â Â Â Â Â Â Â Â Default=0,Â //ä¸­&è‹±
Â Â Â Â Â Â Â Â Chinese=1,Â //å¤„ç†è¿‡çš„å¼‚å¸¸å°½é‡ä¸­æ–‡,æœªå¤„ç†çš„è¿˜æ˜¯è‹±æ–‡
Â Â Â Â Â Â Â Â English=2Â //å…¨éƒ¨è‹±æ–‡
Â Â Â Â }
```

* ç”¨æ³•ï¼š
```csharp
SqlSugarClientÂ dbÂ =Â newÂ SqlSugarClient(newÂ ConnectionConfig()
Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ConnectionStringÂ =Â Config.ConnectionString,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â DbTypeÂ =Â DbType.SqlServer,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LanguageType=LanguageType.English,//åªæ˜¾ç¤ºè‹±æ–‡
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â IsAutoCloseConnectionÂ =Â trueÂ 
Â Â Â });
```

## 8.é•¿è¿æ¥ã€çŸ­è¿æ¥ç”¨æ³•
* é•¿è¿æ¥ â†’ IsAutoCloseConnectionÂ =false â†’ ä¸è‡ªåŠ¨é‡Šæ”¾
* çŸ­è¿æ¥ â†’ IsAutoCloseConnectionÂ =true â†’ è‡ªåŠ¨é‡Šæ”¾

### 8.1 è‡ªåŠ¨é‡Šæ”¾(çŸ­è¿æ¥ï¼Œæ¨èè¿™æ ·ä½¿ç”¨)

* ä¸éœ€è¦å†å»å†™ Using æˆ–è€… Open æˆ–è€… Close
* æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µï¼Œæ¯æ¬¡æ“ä½œè‡ªåŠ¨è°ƒç”¨ Open æˆ–è€… Close
* æœ‰äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¼€å¯äº‹åŠ¡è°ƒç”¨ Open ,æäº¤æˆ–å›æ»šäº‹åŠ¡è°ƒç”¨ Close

```
IsAutoCloseConnectionÂ =Â true//è‡ªåŠ¨é‡Šæ”¾
```

### 8.2 å¦‚ä½•ä½¿ç”¨é•¿è¿æ¥

* äº‹åŠ¡ä¸­é»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œç»“æŸåä¼šè‡ªåŠ¨å…³é—­
* åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼ŒIsAutoCloseConnectionÂ =Â false å³æ˜¯æ‰‹åŠ¨é‡Šæ”¾
* è‡ªåŠ¨é‡Šæ”¾æ¨¡å¼ä¸­ï¼Œä¸ä½¿ç”¨äº‹åŠ¡çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ OpenAlwayså®ç°é•¿è¿æ¥

```csharp
//5.0.6.3
Â usingÂ (db.Ado.OpenAlways())Â 
 {
Â Â Â Â Â db.Queryable...
Â Â Â Â Â db.Insertable...
Â }
```

### 8.3 ä½¿ç”¨åœºæ™¯

* æ’å…¥ä¸€ä¸ªå±€éƒ¨ä¸´æ—¶è¡¨ï¼Œå¦‚æœä¸åœ¨ä¸€ä¸ªä¼šè¯ä¸­ï¼ŒæŸ¥è¯¢ä¸åˆ°ï¼Œè¿™æ—¶å€™å¯ä»¥å°†ä¸´æ—¶è¡¨æ“ä½œå’Œä¹‹åçš„æ“ä½œæ”¾åœ¨ä¸€èµ·ï¼Œä½¿ç”¨ db.Ado.OpenAlways() å®ç°é•¿è¿æ¥

## 9.é…ç½®æœ€å°æ—¶é—´
>`é’ˆå¯¹æ—¶é—´ç±»å‹çš„å­—æ®µ`
  `æ¨èè¿˜æ˜¯ä½¿ç”¨é»˜è®¤çš„ï¼Œè¿™æ ·å¤šç§æ•°æ®åº“ä½¿ç”¨ä¸ä¼šæŠ¥é”™`
  `å¦‚æœéœ€è¦å¼ºåˆ¶æŒ‡å®šï¼Œå†æ·»åŠ æ­¤ä»£ç `
```csharp
//5.0.8.1
db.CurrentConnectionConfig.MoreSettingsÂ =Â newÂ ConnMoreSettings
Â Â {
Â Â Â Â Â Â Â Â DbMinDateÂ =Â DateTime.MinValue//é»˜è®¤æœ€å°æ—¶é—´æ˜¯Â 1900-01-01Â 00:00:00.000Â 
Â Â Â };
```


[ğŸ“„æ–‡æ¡£å‚è€ƒï¼šå…¥é—¨å¿…çœ‹](https://www.donet5.com/home/Doc?typeId=1181)<br/>
[ğŸ“„æ–‡æ¡£å‚è€ƒï¼šå•ä¾‹æ¨¡å¼](https://www.donet5.com/Home/Doc?typeId=2352)





<div id="NavigateDiv">
<table style="border:none;">
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink);font-size:18px;" > ç›®å½•å¯¼èˆª </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_1ä¸Šä¸‹æ–‡æ¦‚å¿µ" > 1.ä¸Šä¸‹æ–‡æ¦‚å¿µ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_2åˆ›å»ºå¯¹è±¡" > 2.åˆ›å»ºå¯¹è±¡ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_21-sqlsugarclient" > &emsp;2.1 SqlSugarClient </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_211-é™æ€æ–¹æ³•æ¡ˆä¾‹" > &emsp;&emsp;2.1.1 é™æ€æ–¹æ³•æ¡ˆä¾‹ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_212-sqlsugariocæ³¨å…¥æ¡ˆä¾‹" > &emsp;&emsp;2.1.2 SqlSugar.IOCæ³¨å…¥æ¡ˆä¾‹ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_213-net-iocæ³¨å…¥æ¡ˆä¾‹" > &emsp;&emsp;2.1.3 .NET IOCæ³¨å…¥æ¡ˆä¾‹ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_22-sqlsugarscope" >  &emsp;2.2 SqlSugarScope </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_221-é™æ€å­—æ®µæ¡ˆä¾‹" > &emsp;&emsp;2.2.1 é™æ€å­—æ®µæ¡ˆä¾‹ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_222-sqlsugariocæ³¨å…¥æ¡ˆä¾‹" > &emsp;&emsp;2.2.2 SqlSugar.IOCæ³¨å…¥æ¡ˆä¾‹ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_223-net-iocæ³¨å…¥æ¡ˆä¾‹" > &emsp;&emsp;2.2.3 .NET IOCæ³¨å…¥æ¡ˆä¾‹ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_3è¿æ¥å‚æ•°" > 3.è¿æ¥å‚æ•° </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_4è®¾ç½®è¶…æ—¶æ—¶é—´" > 4.è®¾ç½®è¶…æ—¶æ—¶é—´ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_5éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ" > 5.éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_6æ‰“å°sql" > 6.æ‰“å°Sql </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_7å›½é™…åŒ–" > 7.å›½é™…åŒ– </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_8é•¿è¿æ¥ã€çŸ­è¿æ¥ç”¨æ³•" > 8.é•¿è¿æ¥ã€çŸ­è¿æ¥ç”¨æ³• </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_81-è‡ªåŠ¨é‡Šæ”¾çŸ­è¿æ¥ï¼Œæ¨èè¿™æ ·ä½¿ç”¨" > &emsp;8.1 è‡ªåŠ¨é‡Šæ”¾(çŸ­è¿æ¥ï¼Œæ¨èè¿™æ ·ä½¿ç”¨) </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_82-å¦‚ä½•ä½¿ç”¨é•¿è¿æ¥" > &emsp;8.2 å¦‚ä½•ä½¿ç”¨é•¿è¿æ¥ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_83-ä½¿ç”¨åœºæ™¯" > &emsp;8.3 ä½¿ç”¨åœºæ™¯ </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/ä»é›¶å¼€å§‹/å…¥é—¨å¿…çœ‹?id=_9é…ç½®æœ€å°æ—¶é—´" > 9.é…ç½®æœ€å°æ—¶é—´ </a></td>
    </tr>
</table>
</div>