
!> MySqlæ³¨æ„äº‹é¡¹ï¼š
* MYSQLä¸æ”¯æŒåˆ›å»ºè¡¨å’Œåˆ é™¤è¡¨å¤„ç†äº‹åŠ¡,åŸç”Ÿäº‹åŠ¡ä¹Ÿä¸€æ ·
* MyISAMÂ å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡Â éœ€è¦æ”¹æˆÂ InnoDBÂ 

## 1.å•åº“äº‹åŠ¡

å•åº“äº‹åŠ¡æ˜¯é’ˆä¸€ä¸ªdbæ“ä½œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œæ— è®ºæ˜¯Â ISqlSugarClientå’ŒÂ Â SqlSugarClientÂ ç”¨æ³•éƒ½ä¸€æ ·

```csharp
    static void Main(string[] args)
Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â  var db = Sugar.GetInstance();
            
Â Â Â Â Â Â Â Â Â Â Â  try
Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.Ado.BeginTran();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.Insertable(new Student() { Id = "1", Name ="hpf", SchoolId = 1 }).ExecuteCommand();
                
                Â throw new Exception(); //æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œå›æ»šSql
                 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.Ado.CommitTran();
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  catch (Exception ex)
Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.Ado.RollbackTran();
Â Â Â Â Â Â Â Â Â Â Â  }
            
Â Â Â Â Â Â Â Â Â Â Â  Console.ReadLine();
Â Â Â Â Â Â Â  }
```

* å¦‚æœä¸€ä¸ªdbå°±ä¸€ä¸ªåº“ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥ç”¨å¤šç§Ÿæˆ·äº‹åŠ¡èŠ‚çº¦ä»£ç ï¼Œå› ä¸º2è€…åœ¨ä¸€ä¸ªåº“çš„æƒ…å†µä¸‹ä½œç”¨ä¸€æ ·

```csharp
db.BeginTran(); //å»æ‰äº†.ado
db.CommitTran(); //å»æ‰äº†.ado
db.RollbackTran(); //å»æ‰äº†.ado
```


## 2.å¤šç§Ÿæˆ·äº‹åŠ¡(å¯è·¨åº“)

ç›®å‰è¿˜æ²¡æœ‰å­¦ä¹ å¤šç§Ÿæˆ·æœ‰å…³çŸ¥è¯†

## 3.è°ƒè¯•äº‹åŠ¡

* db.ContextIdä» `äº‹åŠ¡å¼€å§‹ã€CURDã€äº‹åŠ¡ç»“æŸ`Â å¿…é¡»ä¸€è‡´Â è¿™ä¸ªäº‹åŠ¡æ‰ä¼šç”Ÿæ•ˆï¼Œå¦‚æœæ˜¯MYSQLä¹Ÿæ£€æŸ¥ä¸€ä¸‹è¡¨å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡
* SqlsugarClientÂ å¯ä»¥ç”¨å˜é‡ var db=å¤–éƒ¨Db;Â æ‰€æœ‰æ“ä½œä½¿ç”¨dbä¿è¯ä¸€è‡´Â 
* SqlsuagrScope ï¼ˆè¯¥å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨å¯¹è±¡ï¼Œå¯ä»¥å•ä¾‹ï¼‰å¯ä»¥ç”¨å•ä¾‹æ¨¡å¼ä¿è¯ä¸€è‡´

**é¡¹ç›®è¿è¡Œèµ·æ¥çš„æ—¶å€™ï¼Œåœ¨ç›‘è§†ä¸­æ‰‹åŠ¨è¾“å…¥ db.ContextId ï¼Œä»¥ä¾¿ç›‘æ§å€¼æ˜¯å¦ä¿æŒä¸å˜**

![](https://cdn.jsdelivr.net/gh/DotNeter-Hpf/Images/img/20220523003912.png)


## 4.è¯­æ³•ç³–

ç‰¹å®šè¯­æ³•ï¼Œæ–¹ä¾¿å®ç”¨

### 4.1 è¯­æ³•ç³–ä¸€
`è¿™ç§é€‚åˆå…¨å±€å¼‚å¸¸ï¼Œç›´æ¥å‡ºé”™æ‰”å‡ºå¹¶ä¸”å›æ»š`
**è¿™ç§æ–¹å¼æˆ‘æ²¡æµ‹è¯•è¿‡**
```csharp
usingÂ (varÂ tranÂ =Â db.UseTran())
    {
Â Â Â Â Â Â Â Â //ä¸šåŠ¡ä»£ç 
Â Â Â Â Â Â Â Â //é‡Œé¢ç¦æ­¢å†™Â tryå¤„ç†äº‹åŠ¡é€»è¾‘ï¼Œæ ¼å¼ä¸€å®šæŒ‰ç°åœ¨çš„é£æ ¼æ¥
Â 
Â Â Â Â Â Â Â Â tran.CommitTran();
Â Â Â Â Â }
Â Â Â Â Â //è¦å†™Â tryå¤„ç†å¼‚å¸¸å¯ä»¥å†™åœ¨å¤–é¢
```

### 4.2 è¯­æ³•ç³–äºŒ
`è¿™ç§é€‚åˆæ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ï¼Œå‡å°‘äº†tryÂ å¤„ç†`

```csharp
    static void Main(string[] args)
Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â  var db = Sugar.GetInstance();
Â Â Â Â Â Â Â Â Â Â Â  var result = db.UseTran(() =>
Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.Insertable(new Student() { Id = "2", Name = "hpf", SchoolId= 2 }).ExecuteCommand();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  //throw new Exception(); //æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•äº‹åŠ¡å›æ»šåŠŸèƒ½
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return true;
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â if (result.Data == false)
            {
                if (result.IsSuccess == false)
                    Console.WriteLine("äº‹åŠ¡æäº¤å¤±è´¥");
            }
            else
                Console.WriteLine("äº‹åŠ¡æäº¤å®Œæˆ");
                
Â Â Â Â Â Â Â Â Â Â Â  Console.ReadLine();
Â Â Â Â Â Â Â  }
```

## 5.è·¨æ–¹æ³•äº‹åŠ¡
ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†

## 6.CAPäº‹åŠ¡
ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†

## 7.å¼‚æ­¥äº‹åŠ¡

è¯·ä¸è¦åœ¨åŒæ­¥æ–¹æ³•é‡Œé¢å†™ä¸‹é¢æ–¹ä»£ç ï¼Œå¿…é¡»æ˜¯å¼‚æ­¥æ–¹æ³•æ‰è¡ŒÂ è¿”å›æ˜¯è¦å¸¦æœ‰Task async

### 7.1 ç”¨æ³•ä¸€

```csharp
static async Task Main(string[] args)
        {
            var db = Sugar.GetInstance();
            try
            {
                db.BeginTran();

                await db.Insertable(new Student() { StudentId=13,  Name="qwe"}).ExecuteCommandAsync();
               //throw new Exception(); //æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•äº‹åŠ¡å›æ»šåŠŸèƒ½
                db.CommitTran();
            }
            catch (Exception)
            {
                db.RollbackTran();
            }

            Console.ReadLine();
        }
```

### 7.2 ç”¨æ³•äºŒ

`æ³¨æ„ï¼š`
awaitÂ db.UseTranAsyncÂ å‰é¢çš„awaitä¸è¦æ¼æ‰äº†

```csharp
    public class Program
Â Â Â  {
Â Â Â Â Â Â Â  static async Task Main(string[] args)
Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â  var db = Sugar.GetInstance();
Â Â Â Â Â Â Â Â Â Â Â  await Test(db);
Â Â Â Â Â Â Â Â Â Â Â  Console.ReadLine();
Â Â Â Â Â Â Â  }


Â Â Â Â Â Â Â  public static async Task Test(SqlSugarClient db)
Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â  //å¼‚æ­¥äº‹åŠ¡
Â Â Â Â Â Â Â Â Â Â Â  var result = await db.UseTranAsync(async () =>
Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  await db.Insertable(new Student() { Id = "6", Name = "hpf",SchoolId = 2 }).ExecuteCommandAsync();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  //throw new Exception();    //æ‰‹åŠ¨æ¨¡æ‹ŸæŠ›å¼‚å¸¸
Â Â Â Â Â Â Â Â Â Â Â  });


            ifÂ (result.Data==false)Â //è¿”å›å€¼ä¸ºfalse
Â Â Â          {
                if (result.IsSuccess == true) 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â      Console.WriteLine("æ·»åŠ æˆåŠŸ");
Â Â Â Â Â Â Â Â Â Â Â      else 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â      Console.WriteLine("æ·»åŠ å¤±è´¥");
                    throwÂ result.ErrorException;
            }
Â Â Â Â Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  }
Â Â Â  }
```

## 8.è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«

ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†

[ğŸ“„æ–‡æ¡£å‚è€ƒï¼šæ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«](https://blog.csdn.net/eden_tpy/article/details/122401713)


### 8.1 å•åº“æ¨¡å¼ç”¨æ³•
```csharp
try
{
Â Â Â Â db.Ado.BeginTran(IsolationLevel.ReadCommitted);
Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â //ä¸šåŠ¡ä»£ç Â Â 
Â Â Â Â Â Â Â Â Â 
Â Â Â Â db.Ado.CommitTran();
}
catchÂ (ExceptionÂ ex)
{
Â Â Â Â db.RollbackTran();
Â Â Â Â throwÂ ex;
}
```

### 8.2 å¤šç§Ÿæˆ·æ¨¡å¼
```csharp

Â varÂ mysqlDbÂ =Â db.GetConnection("mysql");
Â varÂ mssqlDbÂ =Â db.GetConnection("mssql");
Â try
Â {
Â Â Â Â Â Â Â Â mysqlDb.Ado.BeginTran(IsolationLevel.ReadCommitted);//å¼€å¯åº“1çš„äº‹åŠ¡
Â Â Â Â Â Â Â Â mssqlDb.Ado.BeginTran(IsolationLevel.ReadCommitted);//å¼€å¯åº“2çš„äº‹åŠ¡
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â //ä¸šåŠ¡ä»£ç Â åªèƒ½ç”¨Â Â mysqlDbå’ŒÂ mssqlDbÂ 
Â 
Â Â Â Â Â Â Â Â db.CommitTran();//æ³¨æ„ä¸èƒ½ç”¨db.ado.CommitTran
Â }
Â catchÂ (ExceptionÂ ex)
Â {
Â Â Â Â Â Â Â Â db.RollbackTran();
Â Â Â Â Â Â Â Â throwÂ ex;
}

```
[ğŸ“„æ–‡æ¡£å‚è€ƒï¼šæ•°æ®äº‹åŠ¡](https://www.donet5.com/home/Doc?typeId=1183)