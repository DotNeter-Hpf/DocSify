## ç”¨åˆ°çš„è¡¨ç»“æ„ã€æ•°æ®ã€å®ä½“ç±»

æ–¹ä¾¿æµ‹è¯• Demo

### Student

```sql
DROP TABLE IF EXISTS `student`;
CREATE TABLE `student`  (
  `StudentId` int(11) NOT NULL AUTO_INCREMENT,
  `Name` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  `SchoolId` int(11) NOT NULL,
  PRIMARY KEY (`StudentId`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 13 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;

INSERT INTO `student` VALUES (1, 'Zzr', 1);
INSERT INTO `student` VALUES (2, 'Ls', 2);
INSERT INTO `student` VALUES (3, 'Wem', 3);
INSERT INTO `student` VALUES (4, 'Hpf', 4);
INSERT INTO `student` VALUES (5, 'Zzr', 5);
INSERT INTO `student` VALUES (6, 'hpf', 2);
INSERT INTO `student` VALUES (7, 'hpf', 2);
INSERT INTO `student` VALUES (9, 'hpf', 2);
INSERT INTO `student` VALUES (11, 'qwe', 0);
INSERT INTO `student` VALUES (12, 'qwe', 0);
```

```csharp
public class Student
    {
        [SugarColumn(IsPrimaryKey = true, IsIdentity = true)]
        public int StudentId { get; set; }
        public string Name { get; set; }
        public int SchoolId { get; set; }

        [Navigate(NavigateType.OneToOne, nameof(SchoolId))]//ä¸€å¯¹ä¸€ SchoolIdæ˜¯Studentç±»é‡Œé¢çš„
        public School School { get; set; } //ä¸èƒ½èµ‹å€¼
    }
```

### Order

```sql
DROP TABLE IF EXISTS `order`;
CREATE TABLE `order`  (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `Name` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  `Price` decimal(10, 0) NOT NULL,
  `CreateTime` datetime NULL DEFAULT NULL,
  `CustomId` int(11) NULL DEFAULT NULL,
  PRIMARY KEY (`Id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 6 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;

INSERT INTO `order` VALUES (1, 'Cs1', 1, '2022-01-01 00:05:28', 1);
INSERT INTO `order` VALUES (2, 'Cs2', 2, '2022-02-02 00:05:42', 3);
INSERT INTO `order` VALUES (3, 'Cs3', 3, '2022-03-03 00:05:48', 4);
INSERT INTO `order` VALUES (4, 'Cs4', 4, '2022-03-04 00:05:55', 5);
INSERT INTO `order` VALUES (5, 'Cs5', 5, '2022-03-04 00:05:55', 6);
```

```csharp
public class Order
    {
        [SugarColumn(IsPrimaryKey = true, IsIdentity = true)]
        public int Id { get; set; }

        public string Name { get; set; }

        public decimal Price { get; set; }

        [SugarColumn(IsNullable = true)]
        public DateTime CreateTime { get; set; }

        [SugarColumn(IsNullable = true)]
        public int CustomId { get; set; }
    }
```

## 1.æ™®é€šåˆ†ç»„æŸ¥è¯¢(ç”¨ where)

```csharp
var list1 = db.Queryable<Student>().Where(it => it.StudentId > 2)
Â Â Â Â Â Â Â Â Â Â Â Â Â  Â .GroupBy(it => new { it.Name })
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .Select(it => new { Sum =SqlFunc.AggregateAvg(it.StudentId), Name = it.Name }).ToList();

//SELECT AVG(`StudentId`) AS `Sum` , `Name` AS `Name`Â  FROM `Student`Â  WHERE( `StudentId` > '2')GROUP BY `Name`
```

## 2.èšåˆå¯¹è±¡æ¡ä»¶ç­›é€‰(ç”¨ Having)

åœ¨ SQL ä¸­å¢åŠ  HAVING å­å¥åŸå› æ˜¯ï¼ŒWHERE å…³é”®å­—æ— æ³•ä¸èšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨

```csharp
Â var list2 = db.Queryable<Student>().GroupBy(it => new { it.Name })
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .Having(it => SqlFunc.AggregateCount(it.StudentId) >= 2)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .Select(it => new { Sum =SqlFunc.AggregateAvg(it.StudentId), Name = it.Name }).ToList();

//SELECTÂ  AVG(`StudentId`) AS `Sum` , `Name` AS `Name`Â FROM `Student` GROUP BY `Name`Â  HAVING (COUNT(`StudentId`) >= 2 )
```

## 3.Distinct ä½¿ç”¨

ä¸€èˆ¬ç”¨æ¥æŒ‡å®šå­—æ®µå»é‡å¤,æŸ¥è¯¢ä¸é‡å¤çš„å€¼,å»é‡å­—æ®µ

```csharp
var list = db.Queryable<Student>().Distinct().Select(it => new {CsName = it.Name }).ToList();

//SELECTÂ  DISTINCTÂ  `Name` AS `CsName`Â  FROM `Student`
```

## 4.åˆ†ç»„è·å–ç¬¬ä¸€æ¡

åƒ Oracle ã€SqlServerã€å¯ä»¥ç”¨ PartitionBy å®ç°

### 4.1 MySqlã€Sqlite å†™æ³•

```csharp
var list = db.Queryable<Student>().GroupBy(it => it.Name).Take(1).ToList();

//SELECT `StudentId`,`Name`,`SchoolId` FROM `Student`Â Â  GROUP BY `Name`Â Â  LIMIT 0,1
```

### 4.2 SqlServerã€Oracle å†™æ³•

```csharp
var list = db.Queryable<Order>().Take(1).PartitionBy(it=>it.Name).ToList()

//SELECT `StudentId`,`Name`,`SchoolId` FROM `Student`Â Â  GROUP BY `Name`Â Â  LIMIT 0,1
```

## 5.æŒ‰ç…§å¹´æœˆæ—¥åˆ†ç»„

æŒ‰ç…§å¹´ã€æœˆåˆ†ç»„ï¼Œç”¨ Select æŠ•å½±å‡ºä¸€ä¸ªåŒ¿åå¯¹è±¡ç±»å‹

```csharp
var list = db.Queryable<Order>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .Select(it => new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  name = it.Name,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  year = it.CreateTime.Year,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  month = it.CreateTime.Month
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  })
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .MergeTable()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .GroupBy(it => new { it.year, it.month })//å¯¹æ–°è¡¨è¿›è¡Œåˆ†ç»„
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  .Select(it => new
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  date = SqlFunc.MergeString(it.year.ToString(), "-", it.month.ToString()),
                    year = it.year.ToString(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  month = it.month.ToString(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  count = SqlFunc.AggregateCount(it.name)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }).
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ToList();

//SELECT  concat(CAST(`year` AS CHAR),'-',CAST(`month` AS CHAR)) AS `date` ,
				CAST(`year` AS CHAR) AS `year` ,
				CAST(`month` AS CHAR) AS `month` ,
				COUNT(`name`) AS `count`
FROM  (SELECT  `Name` AS `name` , Year(`CreateTime`) AS `year` , Month(`CreateTime`) AS `month`  FROM `Order`  ) MergeTable
GROUP BY `year`,`month`
```

- MergeTable()ï¼šå°†æŸ¥è¯¢å‡ºæ¥çš„ç»“æœåˆå¹¶æˆä¸€ä¸ªæ–°è¡¨ï¼Œå¦‚æœæƒ³æŸ¥çœ‹å…·ä½“ç»“æœï¼Œéœ€è¦åŠ ä¸Š .ToList();
- SqlFunc.MergeString()ï¼šåˆå¹¶å­—ç¬¦ä¸²

![](https://cdn.jsdelivr.net/gh/DotNeter-Hpf/Images/img/20220707104255.png)

## 6.æŒ‰ç…§æ—¥æœŸåˆ†ç»„

```csharp
var list5 = db.Queryable<Order>().Select(it => new {
                Id = it.Id,
                Name = it.Name,//è¿™å„¿ä¸èƒ½å†™èšåˆå‡½æ•°ï¼Œå› æ²¡åˆ†ç»„
                Price = it.Price,
                CreateTime = it.CreateTime.Date//åªå–æ—¥æœŸ
            })
            .MergeTable()//å°†æŸ¥è¯¢ç»“æœè½¬æˆä¸€ä¸ªè¡¨
            .GroupBy(it => it.CreateTime)
            .Select(it => new { id = SqlFunc.AggregateMax(it.Id),price = SqlFunc.AggregateSum(it.Price), crate = it.CreateTime })
            .ToList();

//SELECT  MAX(`Id`) AS `id` , SUM(`Price`) AS `price` , `CreateTime` AS `create`
//FROM  (SELECT  `Id` AS `Id` , `Name` AS `Name` , `Price` AS `Price` , CAST(`CreateTime` AS DATE) AS `CreateTime`  FROM `Order`  ) MergeTable
//GROUP BY `CreateTime`
```

![](https://cdn.jsdelivr.net/gh/DotNeter-Hpf/Images/img/20220707104321.png)

[ğŸ“„ æ–‡æ¡£å‚è€ƒï¼šåˆ†ç»„å»é‡](https://www.donet5.com/home/Doc?typeId=2243)
[ğŸ“„ æ–‡æ¡£å‚è€ƒï¼šæŸ¥è¯¢å‡½æ•°](https://www.donet5.com/home/Doc?typeId=1190)

<div id="NavigateDiv">
<table style="border:none;">
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink);font-size:18px;" > ç›®å½•å¯¼èˆª </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=ç”¨åˆ°çš„è¡¨ç»“æ„ã€æ•°æ®ã€å®ä½“ç±»" > ç”¨åˆ°çš„è¡¨ç»“æ„ã€æ•°æ®ã€å®ä½“ç±» </a></td>
    </tr>
    <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=student" > &emsp;Student </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=order" > &emsp;Order </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_1æ™®é€šåˆ†ç»„æŸ¥è¯¢ç”¨-where" > 1.æ™®é€šåˆ†ç»„æŸ¥è¯¢(ç”¨ where) </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_2èšåˆå¯¹è±¡æ¡ä»¶ç­›é€‰ç”¨-having" > 2.èšåˆå¯¹è±¡æ¡ä»¶ç­›é€‰(ç”¨ Having) </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_3distinct-ä½¿ç”¨" >  3.Distinct ä½¿ç”¨ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_4åˆ†ç»„è·å–ç¬¬ä¸€æ¡" > 4.åˆ†ç»„è·å–ç¬¬ä¸€æ¡ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_41-mysqlã€sqlite-å†™æ³•" > &emsp;4.1 MySqlã€Sqlite å†™æ³• </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_42-sqlserverã€oracle-å†™æ³•" > &emsp;4.2 SqlServerã€Oracle å†™æ³• </a></td>
    </tr>
     </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_5æŒ‰ç…§å¹´æœˆæ—¥åˆ†ç»„" > 5.æŒ‰ç…§å¹´æœˆæ—¥åˆ†ç»„ </a></td>
    </tr>
     <tr style="border:none;">
    <td style="border:none;width:300px"><a style="color:var(--sidebarSublink)" href="/#/SqlSugar/æ•°æ®æŸ¥è¯¢/åˆ†ç»„å»é‡?id=_6æŒ‰ç…§æ—¥æœŸåˆ†ç»„" > 6.æŒ‰ç…§æ—¥æœŸåˆ†ç»„ </a></td>
    </tr>
     </tr>
</table>
</div>
